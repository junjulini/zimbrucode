(()=>{"use strict";const e=jQuery;class t{constructor(){this.global=zc.getModuleData("panel")}scrollbarTop(){e(".zc-panel .zc-scrollbar").scrollTop(0)}calcHeight(){this.getCache("wp-body-height")!==e(window).height()&&this.addCache("wp-body-height",e(window).height())}eraseMobileMenu(){this.isDesktopMode()?!0===this.service("menu/isSubmenuItem")&&(e(".zc-panel-menu").addClass("zc-panel-menu_submenu-active"),e(".zc-panel-content").addClass("zc-panel-content_submenu-active")):(e(".zc-panel-menu").removeClass("zc-panel-menu_submenu-active"),e(".zc-panel-content").removeClass("zc-panel-content_submenu-active")),e(".zc-panel-content").removeClass("zc-panel-content_mobile-menu-visible"),e(".zc-panel-header__controller-button_type_mobile-menu").removeClass("zc-panel-header__controller-button_type_mobile-menu_active"),this.service("close-block").hideDefinitely()}isDesktopMode(){return e(".zc-panel").width()>=this.getConfig("min-size/mode2")}errorCheck(t,c){e(".zc-popup").hasClass("zc-panel-error-confirm")||(e(".zc-popup").length&&e(".zc-popup").remove(),console.error(c),zc.confirm({title:t,subject:`${c} <br> Page will be reloaded, ok?`,class:"zc-panel-error-confirm",ok:()=>{location.reload()}}))}getVar(e,t){const c=zc.deepFindAndSetting(this.global.vars,e);return void 0!==c?c:t}addVar(e,t){zc.deepFindAndSetting(this.global.vars,e,t)}addCache(e,t){zc.deepFindAndSetting(this.global.cache,e,t)}getCache(e,t){const c=zc.deepFindAndSetting(this.global.cache,e);return void 0!==c?c:t}remCache(e){zc.deepFindAndSetting(this.global.cache,e,!1,!0)}addConfig(e,t){zc.deepFindAndSetting(this.global.config,e,t)}getConfig(e,t){const c=zc.deepFindAndSetting(this.global.config,e);return void 0!==c?c:t}service(t,c){if(void 0!==t&&"string"==typeof t){if(!e.isFunction(c)&&"object"!=typeof c){const e=this.getCache(`services/${t}`,!1);if(void 0!==e)return e;throw new Error(`Next service not exist : ${t}`)}this.addCache(`services/${t}`,c)}}on(t,c,o,n=!1){e(".zc-panel").on(t,c,(t=>{!0===n&&t.preventDefault(),o(e(t.currentTarget),t)}))}click(e,t,c=!0){this.on("click",e,t,c)}}const c=jQuery;class o extends t{constructor(){super();let e=c(".zc-panel.zc-panel_mode_meta").width();if(e>0)this.checkPanelWidth(),this.checkPanelHeight();else{let t=setInterval((()=>{e=c(".zc-panel.zc-panel_mode_meta").width(),e>0&&(clearInterval(t),this.checkPanelWidth(),this.checkPanelHeight())}),100)}zc.resize((()=>{this.eraseMobileMenu(),this.checkPanelHeight()}))}addModeSize(e){let t="mode-1-";t=this.getConfig("min-size/mode1")>=e?"mode-1-":this.getConfig("min-size/mode2")>=e?"mode-2-":"mode-3-",c(".zc-panel.zc-panel_mode_meta").attr("data-width",t+e),c(window).trigger("zc/panel/size-changed")}checkPanelHeight(){this.isDesktopMode()?(c(".zc-panel.zc-panel_mode_meta").height("auto"),c(".zc-panel.zc-panel_mode_meta .zc-panel-controls").height("auto"),c(".zc-panel.zc-panel_mode_meta .zc-panel-submenu__scrollbar-container").height("auto")):(c(".zc-panel.zc-panel_mode_meta").height("100%"),c(".zc-panel.zc-panel_mode_meta .zc-panel-controls").height("100%"),c(".zc-panel.zc-panel_mode_meta .zc-panel-submenu__scrollbar-container").height("100%"))}checkPanelWidth(){new ResizeObserver((e=>{void 0!==e[0]&&this.addModeSize(e[0].contentRect.width)})).observe(c(".zc-panel.zc-panel_mode_meta").get(0))}}const n=jQuery;class a extends t{constructor(){super(),this.id=!1,this.closeBlock={__cb:".zc-popup-backup__close-block",show:()=>{n(this.closeBlock.__cb).show()},hide:()=>{n(this.closeBlock.__cb).hide()}},this.popup=zc.popup(),this.backupButton()}backupButton(){this.click(".zc-metabox-panel-backup-button",(()=>{this.id=n(".zc-panel-template_wid").data("post-id"),this.popup.add({title:this.getVar("backup-popup-title"),width:400,height:400,jsonRequest:{action:`zc/module/metabox_panel/backup_${this.getVar("slug")}`,nonce:this.getVar("nonce"),options:{type:"get-content"}},error:e=>{this.errorCheck("MetaboxPanelBackup : Load content",e)},success:()=>{this.saveBackup(),this.deleteAllBackups(),this.deleteBackupItem(),this.restoreBackup()}})}))}saveBackup(){n(".zc-popup").on("click",".zc-popup-backup__save-button",(e=>{e.preventDefault();const t=n(e.currentTarget).parent().find("input").val();t&&void 0!==t&&(this.closeBlock.show(),zc.jsonRequest(`zc/module/metabox_panel/backup_${this.getVar("slug")}`,this.getVar("nonce"),{type:"save",id:this.id,backup_name:t}).then((e=>{this.closeBlock.hide(),"success"===e.result?(n(".zc-popup-backup__no-backups").hasClass("zc-popup-backup__no-backups_active")&&n(".zc-popup-backup__no-backups").removeClass("zc-popup-backup__no-backups_active"),n(".zc-popup-backup__input").val(""),n(".zc-popup-backup__number").text(e.change.count),n(".zc-popup-backup__list").append(e.change.item)):console.error(e.result_msg)})).catch((e=>{this.errorCheck("MetaboxPanelBackup : Save",e),this.closeBlock.hide()})))}))}deleteAllBackups(){n(".zc-popup").on("click",".zc-popup-backup__delete-button",(e=>{e.preventDefault(),this.closeBlock.show(),zc.jsonRequest(`zc/module/metabox_panel/backup_${this.getVar("slug")}`,this.getVar("nonce"),{type:"delete"}).then((e=>{this.closeBlock.hide(),"success"===e.result?(n(".zc-popup-backup__number").text(0),n(".zc-popup-backup__list").empty(),n(".zc-popup-backup__no-backups").addClass("zc-popup-backup__no-backups_active")):console.error(e.result_msg)})).catch((e=>{this.errorCheck("MetaboxPanelBackup : Delete all",e),this.closeBlock.hide()}))}))}deleteBackupItem(){n(".zc-popup").on("click",".zc-popup-backup__item-button_delete",(e=>{e.preventDefault(),this.closeBlock.show(),zc.jsonRequest(`zc/module/metabox_panel/backup_${this.getVar("slug")}`,this.getVar("nonce"),{type:"delete-item",backup_name:n(e.currentTarget).parent().attr("id")}).then((t=>{this.closeBlock.hide(),"success"===t.result?(n(".zc-popup-backup__number").text(t.count),n(e.currentTarget).parent().remove(),0==t.count&&n(".zc-popup-backup__no-backups").addClass("zc-popup-backup__no-backups_active")):console.error(t.result_msg)})).catch((e=>{this.errorCheck("MetaboxPanelBackup : Delete item",e),this.closeBlock.hide()}))}))}restoreBackup(){n(".zc-popup").on("click",".zc-popup-backup__item-button_restore",(e=>{e.preventDefault(),this.closeBlock.show(),zc.jsonRequest(`zc/module/metabox_panel/backup_${this.getVar("slug")}`,this.getVar("nonce"),{type:"restore",id:this.id,backup_name:n(e.currentTarget).parent().attr("id")}).then((e=>{this.closeBlock.hide(),"success"===e.result?(this.popup.remContent(),this.popup.appendContent(zc.tpl(' <div class="zc-panel-popup-notification zc-panel-popup-notification_mode_backup zc-panel-popup-notification_type_{{type}}"> <div class="zc-panel-popup-notification__icon-container"> <i class="zc-panel-popup-notification__icon"></i> </div> <div class="zc-panel-popup-notification__content"> <span class="zc-panel-popup-notification__title">{{title}}</span> <p class="zc-panel-popup-notification__text">{{content}}</p> </div> </div>',{type:e.type,title:e.title,content:e.content})),this.popup.showContent(),setTimeout((()=>{location.reload()}),2e3)):console.error(e.result_msg)})).catch((e=>{this.errorCheck("MetaboxPanelBackup : Restore",e),this.closeBlock.hide()}))}))}}const p=' <div class="zc-panel-popup-notification zc-panel-popup-notification_type_{{type}}"> <div class="zc-panel-popup-notification__icon-container"> <i class="zc-panel-popup-notification__icon"></i> </div> <div class="zc-panel-popup-notification__content-container"> <div class="zc-panel-popup-notification__content"> <span class="zc-panel-popup-notification__title">{{title}}</span> <p class="zc-panel-popup-notification__text">{{content}}</p> </div> <div class="zc-panel-popup-notification__close-controller"> <button class="zc-panel-popup-notification__close-button" type="button">{{var_exit}}</button> </div> </div> </div>',i=jQuery;class s extends t{constructor(){super(),this.confirm()}confirm(){this.click(".zc-metabox-panel-reset-button",(()=>{zc.confirm({title:this.getVar("reset-popup-title"),subject:this.getVar("reset-popup-subject"),titleOK:this.getVar("reset-popup-ok"),titleCancel:this.getVar("reset-popup-cancel"),ok:e=>{e.hideContent(),i(window).trigger("zc/metabox-panel/reset/before"),zc.jsonRequest(`zc/module/metabox_panel/reset_${this.getVar("slug")}`,this.getVar("nonce"),{id:i(".zc-panel-template_wid").data("post-id")}).then((t=>{"success"===t.type?(e.remContent(),e.appendContent(zc.tpl(p,{type:t.type??"error",title:t.title??"Error",content:t.content??"Unknown error"})),e.showContent(),setTimeout((()=>{location.reload()}),2e3),i(window).trigger("zc/metabox-panel/reset/success-success")):(e.remContent(),e.appendContent(zc.tpl(p,{type:t.type??"error",title:t.title??"Error",content:t.content??"Unknown error",var_exit:this.getVar("exit")})),e.showContent(),i(".zc-popup").on("click",".zc-panel-popup-notification__close-button",(t=>{t.preventDefault(),e.close()})),i(window).trigger("zc/metabox-panel/reset/success-info"))})).catch((e=>{i(window).trigger("zc/metabox-panel/reset/error"),this.errorCheck("MetaboxPanel : Reset settings",e)}))}})}))}}zc.module.panel.addMode(((e,t)=>{t.addConfig("height-FAH",56),t.addConfig("min-size/mode2",780),t.closeBlock(),t.controlInit(),t.controlHelp(),t.scrollbar(),t.noMetaScaleIfMobile(),t.condition(),t.tooltip(),t.menu(),new o,new a,new s,e(".zc-panel-template__panel-loading").hide(),e(".zc-panel.zc-panel_mode_meta").css("visibility","visible"),t.disableSaveButton=()=>{},t.enableSaveButton=()=>{},t.disableResetButton=()=>{},t.enableResetButton=()=>{}}))})();